<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <style>
      :root {
        --accent-color: #05a081;
        --accent-color-light: #82d0c0;
      }
    </style>

    <meta name="theme-color" content="#05a081" />

    
      <link rel="icon" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="48x48" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="72x72" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;6dfeb9b0bd094d5a00.png" />
      <link rel="apple-touch-icon" sizes="96x96" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;3959b3b31b7ae92700.png" />
      <link rel="apple-touch-icon" sizes="144x144" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;e644b27af091684500.png" />
      <link rel="apple-touch-icon" sizes="192x192" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;3344ee474c2d849c00.png" />
      <link rel="apple-touch-icon" sizes="256x256" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;d92103ca49c6bd5e00.png" />
      <link rel="apple-touch-icon" sizes="384x384" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;b8dd2689e662c9cd00.png" />
      <link rel="apple-touch-icon" sizes="512x512" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;c0d9496000275d3400.png" />
    

    

    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary">

    

    

    
      
        <meta name="description" content="Chema&#x27;s blog." />
        <meta name="twitter:description" content="Chema&#x27;s blog.">
      
    

    
      <meta name="twitter:title" content="Never use array_merge in a loop">
    

    
      <link rel="prerender" href="&#x2F;about&#x2F;" />
    
      <link rel="prerender" href="&#x2F;blog&#x2F;" />
    

    <link rel="prefetch" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;53af5229a2f8852200.png" />

    <title>
      
        
          Never use array_merge in a loop
        
      
    </title>

    
    
      <link rel="stylesheet" href="https://chemaclass.es/main.css">
    
    
  
    <link rel="prerender" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;typed-arrays-php&#x2F;">
  

  
    <link rel="prerender" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;sharing-git-patches&#x2F;">
  

  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;software&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;php&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;array&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;performance&#x2F;">
  

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://google.com/article"
      },
      "headline": "Never use array_merge in a loop",
      "image": [],
      "datePublished": "2020-11-10T00:00:00+00:00",
      "dateModified": "2020-11-10T00:00:00+00:00"
    }
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        

        
        {
          
          "@type": "ListItem",
          "position": 1,
          "name": "Chemaclass | Jose Maria Valera Reales",
          "item": "https://chemaclass.es/"
        },
        
        {
          
          "@type": "ListItem",
          "position": 2,
          "name": "",
          "item": "https://chemaclass.es/blog/"
        },
        
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Never use array_merge in a loop",
          "item": "https://chemaclass.es/blog/array-merge-in-loop/"
        }
      ]
    }
  </script>

  </head>
  <body>
    
      <header>
        <a class="profile-icon" href="/">
          <img src="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;53af5229a2f8852200.png" alt="profile picture">
        </a>
        <nav>
          
            <a href="&#x2F;about&#x2F;">About</a>
          
            <a href="&#x2F;blog&#x2F;">Blog</a>
          
        </nav>
      </header>
    
    <main>
    
  <div class="post-title">
    <h1>Never use array_merge in a loop</h1>
    <small>
      November 10, 2020
      
        - 
        <span class="tags">
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;software&#x2F;">software</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;php&#x2F;">php</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;array&#x2F;">array</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;performance&#x2F;">performance</a>
          
        </span>
      
    </small>
  </div>

  <div>
    <blockquote>
<p>The spread operator to the rescue.</p>
</blockquote>
<h1 id="flattening-a-one-level-array">Flattening a one-level array</h1>
<p>I have seen people using the array_merge function in a loop like:</p>
<pre><code class="language-php" data-lang="php">$lists = [
  [1, 2],
  [3, 4],
  [5, 6],
];
$merged = [];
foreach($lists as $list) {
    $merged = array_merge($merged, $list);
}
// $merged === [1, 2, 3, 4, 5, 6];
</code></pre>
<p>This is a very bad practice because it’s a (memory) performance killer!
Instead, you should use the spread operator (in PHP since 5.6!):</p>
<pre><code class="language-php" data-lang="php">$lists = [
  [1, 2],
  [3, 4],
  [5, 6],
];
$merged = array_merge(...$lists);
// === [1, 2, 3, 4, 5, 6];
</code></pre>
<h2 id="unpacking-an-assoc-array">Unpacking an assoc-array</h2>
<p>What if you had an assoc-array instead like this one?</p>
<pre><code class="language-php" data-lang="php">$lists = [
  'key-1' =&gt; [1, 2],
  'key-2' =&gt; [3, 4],
  'key-3' =&gt; [5, 6],
];
</code></pre>
<p>In that case, you will need to unpack its values:</p>
<pre><code class="language-php" data-lang="php">$merged = array_merge(...array_values($lists));
// === [1, 2, 3, 4, 5, 6];
</code></pre>
<p>In Functional Programming, this is known as flatting a list.
No loops &amp; no more performance problem.</p>
<h1 id="flatting-a-multilevel-array">Flatting a multilevel array</h1>
<p>What if you wanted to flat a multilevel array like this one?</p>
<pre><code class="language-php" data-lang="php">$lists = [[1], 2, [[3, 4], 5], [[[]]], [[[6]]], 7, 8, []];
</code></pre>
<p>Or like this one, even with key-values?</p>
<pre><code class="language-php" data-lang="php">$lists = [
    'key-1' =&gt; [
        1,
        [2],
        'key-2' =&gt; [
            3,
            [
                'key-3' =&gt; [4, 5],
            ],
        ],
    ],
    6,
    'key-4' =&gt; [7, 8],
];
</code></pre>
<p>In these cases, you might want to use the internal standard library:</p>
<pre><code class="language-php" data-lang="php">$merged = iterator_to_array(
    new RecursiveIteratorIterator(
        new RecursiveArrayIterator($lists)
    ),
    $use_keys = false
);
// $merged === [1, 2, 3, 4, 5, 6, 7, 8];
</code></pre>
<h1 id="conclusion">Conclusion</h1>
<p>Usually, being aware of how to flat a “2 level” array might be sufficient:</p>
<pre><code class="language-php" data-lang="php">$flattenList = array_merge(...array_values($lists));
</code></pre>
<p>Otherwise, the internal standard library will help you deal with it.</p>

  </div>

  <hr class="footer-rule" />

  
    <div class="footer-about">
      <p>I love writing about stuff that I find interesting and bring some value to my life,<br>
so I can share them with you.</p>

    </div>
  

  <div class="related-container">

    
      <div class="link">
        Previous <br />
        <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;typed-arrays-php&#x2F;">Typed arrays in PHP</a>
      </div>
    

    
      <div class="link">
        Next <br />
        <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;sharing-git-patches&#x2F;">Sharing your git patches</a>
      </div>
    

  </div>


    </main>
  </body>
</html>
