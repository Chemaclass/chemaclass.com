<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <style>
      :root {
        --accent-color: #05a081;
        --accent-color-light: #82d0c0;
      }
    </style>

    <meta name="theme-color" content="#05a081" />

    
      <link rel="icon" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="48x48" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="72x72" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;6dfeb9b0bd094d5a00.png" />
      <link rel="apple-touch-icon" sizes="96x96" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;3959b3b31b7ae92700.png" />
      <link rel="apple-touch-icon" sizes="144x144" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;e644b27af091684500.png" />
      <link rel="apple-touch-icon" sizes="192x192" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;3344ee474c2d849c00.png" />
      <link rel="apple-touch-icon" sizes="256x256" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;d92103ca49c6bd5e00.png" />
      <link rel="apple-touch-icon" sizes="384x384" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;b8dd2689e662c9cd00.png" />
      <link rel="apple-touch-icon" sizes="512x512" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;c0d9496000275d3400.png" />
    

    

    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary">

    

    

    
      
        <meta name="description" content="Chema&#x27;s blog." />
        <meta name="twitter:description" content="Chema&#x27;s blog.">
      
    

    
      <meta name="twitter:title" content="To mock or not to mock">
    

    
      <link rel="prerender" href="&#x2F;about&#x2F;" />
    
      <link rel="prerender" href="&#x2F;blog&#x2F;" />
    

    <link rel="prefetch" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;53af5229a2f8852200.png" />

    <title>
      
        
          To mock or not to mock
        
      
    </title>

    
    
      <link rel="stylesheet" href="https://chemaclass.es/main.css">
    
    
  
    <link rel="prerender" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;sharing-git-patches&#x2F;">
  

  
    <link rel="prerender" href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;phel-first-release&#x2F;">
  

  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;software&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;mocking&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;testing&#x2F;">
  
    <link rel="prerender"  href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;design&#x2F;">
  

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://google.com/article"
      },
      "headline": "To mock or not to mock",
      "image": [],
      "datePublished": "2021-01-11T00:00:00+00:00",
      "dateModified": "2021-01-11T00:00:00+00:00"
    }
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        

        
        {
          
          "@type": "ListItem",
          "position": 1,
          "name": "Chemaclass | Jose Maria Valera Reales",
          "item": "https://chemaclass.es/"
        },
        
        {
          
          "@type": "ListItem",
          "position": 2,
          "name": "",
          "item": "https://chemaclass.es/blog/"
        },
        
        {
          "@type": "ListItem",
          "position": 3,
          "name": "To mock or not to mock",
          "item": "https://chemaclass.es/blog/to-mock-or-not-to-mock/"
        }
      ]
    }
  </script>

  </head>
  <body>
    
      <header>
        <a class="profile-icon" href="/">
          <img src="https:&#x2F;&#x2F;chemaclass.es&#x2F;processed_images&#x2F;53af5229a2f8852200.png" alt="profile picture">
        </a>
        <nav>
          
            <a href="&#x2F;about&#x2F;">About</a>
          
            <a href="&#x2F;blog&#x2F;">Blog</a>
          
        </nav>
      </header>
    
    <main>
    
  <div class="post-title">
    <h1>To mock or not to mock</h1>
    <small>
      January 11, 2021
      
        - 
        <span class="tags">
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;software&#x2F;">software</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;mocking&#x2F;">mocking</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;testing&#x2F;">testing</a>
          
            <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;tags&#x2F;design&#x2F;">design</a>
          
        </span>
      
    </small>
  </div>

  <div>
    <h4 id="how-to-escape-the-mocking-hell">How to escape the mocking hell</h4>
<p>What is actually happening when we create a mock? Which types of mocks are there? Is mocking good or bad? Well, as always, everything depends on the context. And here we will consider some of the main situations about when to mock and when not to mock, but especially why.</p>
<h2 id="what-happens-when-you-mock-something">What happens when you mock something?</h2>
<p>First, we should define what is a mock:</p>
<blockquote>
<p>In a unit test, mock objects can simulate the behavior of complex, real objects and are therefore useful when it is impractical or impossible to incorporate a real object into a unit test.</p>
</blockquote>
<p>Mocking makes sense in a <em>unit testing</em> context. An integration test should go through the real implementation checking the integration between multiple units, which are even allowed to talk to the DB or File IO: infrastructure code. Therefore we should agree that <em>a unit test is a fast and deterministic test that doesn’t rely on external dependencies and doesn’t require any special context to run</em>.</p>
<p>Mock objects meet the <em>interface</em> requirements. In consequence, they allow us to write and unit-test functionality without calling complex underlying or collaborating classes.</p>
<p>A mock is a test double that stands in for real implementation code during the unit testing process. It is also capable of producing assertions about how it was manipulated by the test subject during the test run.</p>
<blockquote>
<p>I strongly recommend you to read this post if you want to get into the details of why <a href="https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a">Mocking is a code smell</a> (Topics like these: What is a mock? What is a unit test? What is test coverage? What is tight coupling? What causes tight coupling? What does composition have to do with mocking? How do we remove coupling? and more!)</p>
</blockquote>
<h2 id="the-problem-with-mocking">The problem with mocking</h2>
<p>When you mock you are overriding the logic of the mocked class. The real logic is getting hidden behind the scenes and there is actually where bugs love to live. Consider that:</p>
<ul>
<li>
<p>The mock may have attributes, methods, or arguments that the real object doesn’t.</p>
</li>
<li>
<p>The mock’s <em>return values may differ from the real objects’ return values</em>. For example, it may return a different type of object that has different attributes.</p>
</li>
<li>
<p>The mock’s <em>side effects and behavior may differ from the real objects’ ones</em>. For example, maybe the mock fails to raise an exception when the real object would raise it.</p>
</li>
</ul>
<h2 id="alternatives-to-mocking">Alternatives to mocking</h2>
<p>“Are you saying that mocking is bad and we shouldn’t mock?!” No.</p>
<p>It depends on what you are “overriding”.</p>
<ul>
<li>Is your business domain logic what you are mocking? Then it’s wrong.</li>
<li>Is the connection to the DB what you are mocking? Then it’s right.</li>
</ul>
<blockquote>
<p>It depends on the context of the logic and where that logic belongs.</p>
</blockquote>
<p>Is it part of your business domain logic? Then you shouldn’t mock it but instantiate it.</p>
<p>Is it part of any infrastructure dependency like DB connection, IO file system, Network, or any external service that has nothing to do directly with your business domain? Then <em>mock it using abstractions/interfaces</em>.</p>
<p>The interface should be the <em>contract between your business domain logic and its external infrastructure dependencies</em>. Imagine how easy it would be to unit test your domain logic by instantiating it and calling their methods with different arguments expecting different inputs under your entire control. <a href="https://medium.com/swlh/unit-testing-effectively-4d1cabc77722">Here is an example of how to unit test written code</a>.</p>
<h2 id="some-tricks">Some tricks</h2>
<p>When you are writing a unit test:</p>
<ul>
<li>Try to instantiate your classes first.</li>
<li>Avoid mocking concrete classes. I wrote an article exclusively about this exclusively: encouraging <a href="https://medium.com/swlh/final-classes-in-php-9174e3e2747e">final classes</a> and interfaces.</li>
</ul>
<blockquote>
<p>Mock interfaces. Instantiate concrete classes.</p>
</blockquote>
<div >
    <iframe src="https://www.youtube-nocookie.com/embed/RbSqXFUfRMU" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>
<p>“Excessive use of mocks leads to legacy code.” — Philippe Boargau</p>
<h3 id="how-can-we-avoid-excessive-mocking">How can we avoid excessive mocking?</h3>
<ul>
<li>Favor immutable state over a mutable state.</li>
<li>Make dependencies explicit.</li>
<li>Program to an interface, not to an implementation.</li>
</ul>

  </div>

  <hr class="footer-rule" />

  
    <div class="footer-about">
      <p>I love writing about stuff that I find interesting and bring some value to my life,<br>
so I can share them with you.</p>

    </div>
  

  <div class="related-container">

    
      <div class="link">
        Previous <br />
        <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;sharing-git-patches&#x2F;">Sharing your git patches</a>
      </div>
    

    
      <div class="link">
        Next <br />
        <a href="https:&#x2F;&#x2F;chemaclass.es&#x2F;blog&#x2F;phel-first-release&#x2F;">Phel: the Lisp that compiles to PHP</a>
      </div>
    

  </div>


    </main>
  </body>
</html>
